
## 📝 主题三：Python 错误记录 (Logging) 笔记

错误记录是编写稳定、可维护程序的核心技能，它提供了一种标准化的方式来追踪程序运行时发生的事件、警告和错误。

### 一、Logging 的核心概念

| 概念 | 描述 |
| :--- | :--- |
| **Logger** | 记录器。它是记录日志的**入口**，通常按模块或功能命名（如 `logging.getLogger("APP_GUI")`）。 |
| **Handler** | 处理器。决定日志信息的**去向**（如写入文件、打印到控制台、发送邮件等）。 |
| **Formatter** | 格式化器。决定日志信息的**格式**（如时间戳、级别、消息内容等）。 |
| **Filter** | 过滤器。在日志信息被处理之前，根据特定规则**筛选**是否记录。 |

-----

### 二、Logging 的五个级别 (Severity Levels)

级别用于表示事件的严重程度。配置时设置的级别，意味着**只有等于或高于该级别的消息才会被处理**。

| 级别 (Level) | 数值 | 应用场景 | 示例用途 |
| :--- | :--- | :--- | :--- |
| **`DEBUG`** | 10 | **开发阶段**。用于详细的诊断信息、变量值追踪、函数调用记录。 | 记录数据库查询参数：`DEBUG: student_id is 100` |
| **`INFO`** | 20 | **生产环境**。用于确认程序按预期运行的关键操作，如用户登录、功能启动。 | 记录成功启动：`INFO: 智能系统启动成功` |
| **`WARNING`** | 30 | **生产环境**。程序遇到非致命、可容忍的问题，但应引起注意。 | 记录配置缺失：`WARNING: 配置文件未找到，使用默认设置` |
| **`ERROR`** | 40 | **生产环境**。程序功能执行失败，通常是由于程序逻辑或外部因素导致。 | 记录数据库操作失败：`ERROR: 无法保存学生数据` |
| **`CRITICAL`** | 50 | **生产环境**。最严重的错误，程序可能崩溃或无法继续运行。 | 记录内存溢出或关键服务停止：`CRITICAL: 核心服务意外终止` |

-----

### 三、关键配置与实践方法

#### 1\. 基础配置 (`basicConfig`)

这是最快设置日志的方法，通常用于脚本或简单应用。

```python
import logging

logging.basicConfig(
    filename='system_activity.log',        # 📢 输出到文件
    level=logging.INFO,                    # 📢 设置最低记录级别
    format='%(asctime)s - %(levelname)s - [%(name)s] - %(message)s',
    encoding='utf-8'                       # 📢 确保中文不乱码
)
```

#### 2\. 推荐实践：使用命名 Logger

创建命名 Logger 可以让你在日志中区分是哪个模块或功能发出的信息（通过 `%(name)s` 字段）。

```python
# 创建 Logger 实例
app_logger = logging.getLogger("APP_GUI")
sys_logger = logging.getLogger("LEARNING_SYS")

# 使用
app_logger.info("用户成功登录")
sys_logger.warning("推荐算法返回空结果")
```

#### 3\. 记录异常 (`logging.exception()`)

这是处理 `try...except` 块时记录错误的最佳方法。

| 方法 | 等同级别 | 作用 |
| :--- | :--- | :--- |
| `logging.exception("消息")` | `logging.error("消息")` | **自动**将当前 `except` 块捕获的**完整堆栈追踪**信息附加到日志消息中。这是追踪程序崩溃的最佳工具。 |

**代码示例：**

```python
try:
    # 尝试执行可能出错的代码
    10 / 0
except Exception as e:
    # 使用 .exception() 确保记录下完整的 Traceback
    app_logger.exception("操作失败！记录完整堆栈追踪。")
```

-----

### 🚀 总结与部署策略

| 阶段 | 推荐 Logging 级别 | 记录目的 |
| :--- | :--- | :--- |
| **开发 / 调试** | `DEBUG` | 追踪程序每一步细节、变量状态。 |
| **生产 / 发布** | `INFO` 或 `WARNING` | 记录关键事件、程序状态变化，忽略冗余的调试信息。 |
